using E2eTestWebApp.Models;
using E2eTestWebApp.Repository;
using Magic.IndexedDb;
using Microsoft.AspNetCore.Components;

namespace E2eTestWebApp.TestPages;

[Route("/OpenTest")]
public class OpenTestPage(IMagicIndexedDb magic) : TestPageBase
{
    public async Task<string> DirectOpen()
    {
        var connection = await magic.Database(IndexDbContext.Employee);
        await connection.OpenAsync();
        return "OK";
    }

    public async Task<string> Get()
    {
        /*_ = await magic.OpenAsync(new DbStore()
        {
            Name = "OpenTest.Get",
            Version = 1,
            StoreSchemas = []
        });
        var database = magic.Get("OpenTest.Get");
        return database.DbName;*/
        
        return "TODO";
    }

    public async Task<string> StoreSchema()
    {
        var connection = await magic.Query<Person>();
        /*_ = await magic.OpenAsync(new DbStore()
        {
            Name = "OpenTest.StoreSchema",
            Version = 1,
            StoreSchemas =
            [
                new StoreSchema()
                {
                    TableName = "S1",
                    Indexes = ["I11", "I12"],
                    PrimaryKey = "P11",
                    PrimaryKeyAuto = true,
                    UniqueIndexes = ["U11", "U12"]
                },
                new StoreSchema()
                {
                    TableName = "S2",
                    Indexes = [],
                    PrimaryKey = "P21",
                    PrimaryKeyAuto = false,
                    UniqueIndexes = ["U21"]
                }
            ]
        });
        return "OK";*/
        
        return "TODO";
    }
}